<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ ê´€ê³„ ë¶„ì„ ê²°ê³¼ - Date Genie</title>
    <link rel="icon" type="image/svg+xml" href="images/icon.svg">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* === Core Reset & Variables === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --navbar-height: 70px;
            --primary-gradient: linear-gradient(135deg, #ec4899, #8b5cf6);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --text-primary: #1f1d3a;
            --text-secondary: #6b7280;
            --bg-card: rgba(255, 255, 255, 0.95);
            --shadow-primary: 0 10px 30px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, #faf5ff 0%, #fdf2f8 40%, #eef2ff 100%);
            min-height: 100vh;
        }

        /* === Navigation === */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--navbar-height);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.25rem;
        }

        .heart-icon {
            color: #ec4899;
            font-size: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 12px;
            background: rgba(124, 58, 237, 0.1);
            color: var(--text-primary);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        /* === Main Container === */
        .results-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: calc(var(--navbar-height) + 2rem) 1rem 3rem;
        }

        /* === Card System === */
        .result-card {
            background: var(--bg-card);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        /* === Two Column Layout System === */
        .two-column-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .column-card {
            background: var(--bg-card);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--shadow-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .column-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        /* === Hero Success Dashboard === */
        .hero-dashboard {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
            position: relative;
        }

        .success-meter {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 2rem;
        }

        .success-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #ec4899 0%, #8b5cf6 76%, #f3f4f6 76%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: scaleIn 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .success-circle::before {
            content: '';
            position: absolute;
            inset: 20px;
            background: white;
            border-radius: 50%;
        }

        .success-percentage {
            position: absolute;
            font-size: 3rem;
            font-weight: 800;
            color: #7c3aed;
            z-index: 2;
        }

        .relationship-status {
            margin-bottom: 1rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.75rem 2rem;
            background: var(--primary-gradient);
            color: white;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.3);
        }

        .hero-insight {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 1.5rem 0;
            line-height: 1.4;
        }

        .confidence-level {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: var(--success-color);
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* === Chart Containers === */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .chart-title {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        /* === Section Headers === */
        .section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
        }

        .section-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .section-title h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* === Signal Components === */
        .signal-list {
            list-style: none;
        }

        .signal-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .signal-item:last-child {
            border-bottom: none;
        }

        .signal-icon {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            margin-top: 0.2rem;
        }

        .positive-signal .signal-icon {
            background: var(--success-color);
        }

        .warning-signal .signal-icon {
            background: var(--warning-color);
        }

        .signal-content {
            flex: 1;
        }

        .signal-text {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .signal-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .confidence-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .confidence-stars {
            color: #fbbf24;
        }

        /* === Favorite Message Component === */
        .favorite-message {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.05), rgba(139, 92, 246, 0.05));
            border: 2px solid rgba(236, 72, 153, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .message-badge {
            background: var(--primary-gradient);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .message-text {
            background: white;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            font-style: italic;
            color: var(--text-primary);
            border-left: 4px solid #ec4899;
            margin: 1rem 0;
            position: relative;
            font-size: 1.05rem;
            line-height: 1.5;
        }

        .message-meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* === Conversation Guide === */
        .conversation-examples {
            display: grid;
            gap: 1rem;
        }

        .conversation-item {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 1rem;
            border-left: 4px solid var(--info-color);
        }

        .conversation-type {
            font-weight: 600;
            color: var(--info-color);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .conversation-text {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .conversation-timing {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* === Advice Component === */
        .advice-item {
            background: rgba(245, 158, 11, 0.05);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 12px;
            padding: 1rem;
            margin: 0.75rem 0;
        }

        .advice-title {
            font-weight: 600;
            color: var(--warning-color);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .advice-content {
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.4;
        }

        /* === Sticky Note Style === */
        .sticky-note {
            background: #ffeb3b;
            color: #333;
            font-family: 'Malgun Gothic', sans-serif;
            padding: 1.2rem 1.5rem;
            margin: 2rem 0;
            transform: rotate(-1deg);
            border-radius: 0;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
            position: relative;
            border: 1px solid #f9c74f;
        }

        .sticky-note::before {
            content: 'ğŸ“Œ';
            position: absolute;
            top: -8px;
            right: 15px;
            font-size: 1.3rem;
        }

        /* === Action Buttons === */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-primary, .btn-secondary {
            padding: 1rem 2rem;
            border-radius: 16px;
            font-weight: 700;
            font-size: 1.05rem;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            border: none;
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(236, 72, 153, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: #7c3aed;
            border: 2px solid rgba(124, 58, 237, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(124, 58, 237, 0.1);
            border-color: rgba(124, 58, 237, 0.5);
            transform: translateY(-1px);
        }

        /* === Animations === */
        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* === Responsive Design === */
        @media (max-width: 768px) {
            .results-container {
                padding: calc(var(--navbar-height) + 1rem) 0.5rem 2rem;
            }

            .two-column-grid,
            .action-buttons {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .result-card,
            .column-card {
                padding: 1.5rem;
                border-radius: 20px;
            }

            .hero-dashboard {
                padding: 2rem 1rem;
            }

            .success-meter {
                width: 160px;
                height: 160px;
            }

            .success-percentage {
                font-size: 2.5rem;
            }

            .hero-insight {
                font-size: 1.1rem;
            }

            .chart-container {
                height: 250px;
                padding: 0.75rem;
            }
        }

        /* === Accessibility === */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .btn-primary:focus,
        .btn-secondary:focus {
            outline: 3px solid rgba(124, 58, 237, 0.5);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/DateGenie/index.html" class="brand-logo">
                <i class="fas fa-heart heart-icon"></i>
                <span>Date Genie</span>
            </a>
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <span id="userName">ì‚¬ìš©ìë‹˜</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="results-container">
        <!-- 1. í˜¸ê°ë„ (ìµœìƒë‹¨) -->
        <div class="result-card hero-dashboard">
            <div class="relationship-status">
                <div class="status-badge" id="relationshipStage">ì¸ ê°€ëŠ¥ì„± ë†’ìŒ</div>
            </div>
            
            <div class="success-meter">
                <div class="success-circle" id="successCircle">
                    <div class="success-percentage" id="successPercentage">76%</div>
                </div>
            </div>

            <h1 class="hero-insight" id="heroInsight">
                ìƒëŒ€ë°©ì´ ë‹¹ì‹ ì—ê²Œ í˜¸ê°ì„ ê°€ì§€ê³  ìˆì„ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤
            </h1>

            <div class="confidence-level">
                <i class="fas fa-shield-check"></i>
                <span>ë¶„ì„ ì‹ ë¢°ë„: <strong id="confidenceLevel">83%</strong></span>
            </div>
        </div>

        <!-- 2. í˜¸ê°ë„ ë³€í™” ì¶”ì´ + ê°ì •ë¶„ì„ (2ì—´) -->
        <div class="two-column-grid">
            <div class="column-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="section-title">
                        <h3>í˜¸ê°ë„ ë³€í™” ì¶”ì´</h3>
                        <p class="section-subtitle">ìµœê·¼ 10ì¼ê°„ ê´€ì‹¬ë„ ë³€í™”</p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="interestChart"></canvas>
                </div>
            </div>

            <div class="column-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="section-title">
                        <h3>ê°ì • ë¶„ì„</h3>
                        <p class="section-subtitle">ëŒ€í™” í†¤ ê°ì • ë¶„í¬</p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="emotionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 3. ë°œê²¬ëœ í˜¸ê° ì‹ í˜¸ + ëŒ€í‘œ í˜¸ê°ë¬¸ì¥ (2ì—´) -->
        <div class="two-column-grid">
            <div class="column-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="section-title">
                        <h3>ë°œê²¬ëœ í˜¸ê° ì‹ í˜¸</h3>
                        <p class="section-subtitle">ê¸ì •ì  ì‹ í˜¸ ë¶„ì„</p>
                    </div>
                </div>
                <ul class="signal-list" id="positiveSignals">
                    <!-- ë™ì  ìƒì„± -->
                </ul>
            </div>

            <div class="column-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-quote-right"></i>
                    </div>
                    <div class="section-title">
                        <h3>ëŒ€í‘œ í˜¸ê°ë¬¸ì¥</h3>
                        <p class="section-subtitle">ê°€ì¥ í˜¸ê°ë„ê°€ ë†’ì€ ë©”ì‹œì§€</p>
                    </div>
                </div>
                <div class="favorite-message" id="favoriteMessage">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>
        </div>

        <!-- 4. ì‹¤ì „ ëŒ€í™” ê°€ì´ë“œ + ë§ì¶¤ ì¡°ì–¸ (2ì—´) -->
        <div class="two-column-grid">
            <div class="column-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="section-title">
                        <h3>ì‹¤ì „ ëŒ€í™” ê°€ì´ë“œ</h3>
                        <p class="section-subtitle">ë°”ë¡œ ì‚¬ìš©í•  ë©”ì‹œì§€</p>
                    </div>
                </div>
                <div class="conversation-examples" id="conversationGuide">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>

            <div class="column-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="section-title">
                        <h3>ë§ì¶¤ ì¡°ì–¸</h3>
                        <p class="section-subtitle">ìƒí™©ë³„ ì¶”ì²œ í–‰ë™</p>
                    </div>
                </div>
                <div class="advice-list" id="customAdvice">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>
        </div>

        <!-- 5. ìŠ¤í‹°í‚¤ ë…¸íŠ¸ -->
        <div class="sticky-note">
            ğŸ“ ì°¸ê³ : ì´ ëª¨ë“  ê±´ ì œ ê°œì¸ì ì¸ ì˜ê²¬ì´ì—ìš”! 100% ë§ë‹¤ëŠ” ë³´ì¥ì€ ì—†ì–´ìš” ã…‹ã…‹ ê·¸ë˜ë„ ì°¸ê³ ëŠ” ë˜ì‹¤ ê±°ì˜ˆìš”?
        </div>

        <!-- 6. ìƒˆë¡œìš´ ë¶„ì„ + ë¶„ì„ íˆìŠ¤í† ë¦¬ (2ì—´) -->
        <div class="action-buttons">
            <a href="/DateGenie/upload.html" class="btn-primary">
                <i class="fas fa-upload"></i>
                ìƒˆë¡œìš´ ë¶„ì„í•˜ê¸°
            </a>
            <a href="/DateGenie/dashboard.html" class="btn-secondary">
                <i class="fas fa-chart-line"></i>
                ë¶„ì„ íˆìŠ¤í† ë¦¬ ë³´ê¸°
            </a>
        </div>
    </div>

    <!-- Screen Reader Announcements -->
    <div class="sr-only" aria-live="polite" id="announcements"></div>

    <script>
        // === ë™ì  ë°ì´í„° ë¡œë”© ===
        let analysisData = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¶„ì„ ë°ì´í„° ì´ˆê¸°í™”
        async function initializeAnalysisData() {
            try {
                // URLì—ì„œ sessionId íŒŒë¼ë¯¸í„° í™•ì¸
                const urlParams = new URLSearchParams(window.location.search);
                const sessionId = urlParams.get('sessionId');
                
                // localStorageì—ì„œ ë¶„ì„ ê²°ê³¼ í™•ì¸
                const storedResult = localStorage.getItem('analysisResult');
                
                if (storedResult) {
                    // localStorageì— ìˆëŠ” ë°ì´í„° ì‚¬ìš©
                    console.log('localStorageì—ì„œ ë¶„ì„ ë°ì´í„° ë¡œë“œ');
                    analysisData = JSON.parse(storedResult);
                } else if (sessionId) {
                    // APIì—ì„œ ë¶„ì„ ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
                    console.log('APIì—ì„œ ë¶„ì„ ë°ì´í„° ë¡œë“œ:', sessionId);
                    analysisData = await fetchAnalysisResult(sessionId);
                } else {
                    // ë°ëª¨ ë°ì´í„° ì‚¬ìš©
                    console.log('ë°ëª¨ ë°ì´í„° ì‚¬ìš©');
                    analysisData = getDefaultAnalysisData();
                }
                
                // ë°ì´í„° ê²€ì¦ ë° ê¸°ë³¸ê°’ ì„¤ì •
                analysisData = validateAndNormalizeData(analysisData);
                
                console.log('ìµœì¢… ë¶„ì„ ë°ì´í„°:', analysisData);
                
            } catch (error) {
                console.error('ë¶„ì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                
                // ì—ëŸ¬ ë°œìƒ ì‹œ ë°ëª¨ ë°ì´í„° ì‚¬ìš©
                analysisData = getDefaultAnalysisData();
                
                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                if (window.showNotification) {
                    window.showNotification('ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë°ëª¨ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.', 'warning');
                }
            }
        }
        
        // APIì—ì„œ ë¶„ì„ ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
        async function fetchAnalysisResult(sessionId) {
            const response = await fetch(`/DateGenie/AnalysisService?action=getResult&sessionId=${sessionId}`);
            
            if (!response.ok) {
                throw new Error('ë¶„ì„ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            const result = await response.json();
            
            if (!result.success) {
                throw new Error(result.message || 'ë¶„ì„ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            return result.analysisData;
        }
        
        // ë°ì´í„° ê²€ì¦ ë° ì •ê·œí™”
        function validateAndNormalizeData(data) {
            // ê¸°ë³¸ êµ¬ì¡° í™•ì¸ ë° ê¸°ë³¸ê°’ ì„¤ì •
            const normalized = {
                successRate: data.successRate || 0,
                confidenceLevel: data.confidenceLevel || 0,
                relationshipStage: data.relationshipStage || "ë¶„ì„ ì¤‘",
                heroInsight: data.heroInsight || "ë¶„ì„ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
                
                interestTrendData: data.interestTrendData || [],
                emotionData: data.emotionData || { positive: 0, neutral: 0, negative: 0 },
                positiveSignals: data.positiveSignals || [],
                favoriteMessage: data.favoriteMessage || {
                    text: "ë¶„ì„ëœ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.",
                    confidence: 0,
                    date: "ë‚ ì§œ ì—†ìŒ",
                    reason: "ë©”ì‹œì§€ ë¶„ì„ ì¤‘"
                },
                conversationGuide: data.conversationGuide || [],
                customAdvice: data.customAdvice || []
            };
            
            // ë¹ˆ ë°ì´í„°ì— ëŒ€í•œ ê¸°ë³¸ê°’ ì„¤ì •
            if (normalized.interestTrendData.length === 0) {
                normalized.interestTrendData = getDefaultTrendData();
            }
            
            if (normalized.conversationGuide.length === 0) {
                normalized.conversationGuide = getDefaultConversationGuide();
            }
            
            return normalized;
        }
        
        // ê¸°ë³¸ ì¶”ì´ ë°ì´í„°
        function getDefaultTrendData() {
            return [
                { date: '8ì›” 13ì¼', value: 45 },
                { date: '8ì›” 14ì¼', value: 52 },
                { date: '8ì›” 15ì¼', value: 48 },
                { date: '8ì›” 16ì¼', value: 58 },
                { date: '8ì›” 17ì¼', value: 62 },
                { date: '8ì›” 18ì¼', value: 59 },
                { date: '8ì›” 19ì¼', value: 67 },
                { date: '8ì›” 20ì¼', value: 71 },
                { date: '8ì›” 21ì¼', value: 69 },
                { date: '8ì›” 22ì¼', value: 76 }
            ];
        }
        
        // ê¸°ë³¸ ëŒ€í™” ê°€ì´ë“œ
        function getDefaultConversationGuide() {
            return [
                {
                    type: "ì¼ìƒ ê³µìœ ",
                    text: "ì˜¤ëŠ˜ ë‚ ì”¨ ì§„ì§œ ì¢‹ë‹¤! ë°–ì— ë‚˜ê°€ê³  ì‹¶ì–´ì§€ëŠ” ë‚ ì”¨ì•¼ ğŸ˜„",
                    timing: "ì˜¤í›„ 2-6ì‹œ ì¶”ì²œ"
                },
                {
                    type: "ê´€ì‹¬ì‚¬ ì§ˆë¬¸",
                    text: "ìš”ì¦˜ ë­ ì¬ë°ŒëŠ” ê±° ìˆì–´? ë‚˜ë„ ìƒˆë¡œìš´ ì·¨ë¯¸ ì°¾ê³  ìˆì–´ì„œ ã…ã…",
                    timing: "ì €ë… ì‹œê°„ëŒ€ ì¶”ì²œ"
                },
                {
                    type: "ë§Œë‚¨ ì œì•ˆ",
                    text: "í˜¹ì‹œ ì‹œê°„ ë˜ë©´ ì»¤í”¼ í•œ ì” ì–´ë•Œ? ì˜¤ëœë§Œì— ìˆ˜ë‹¤ ë–¨ê³  ì‹¶ì–´ â˜•",
                    timing: "ì£¼ë§ ì˜¤ì „ ì¶”ì²œ"
                }
            ];
        }
        
        // ë°ëª¨/ê¸°ë³¸ ë°ì´í„°
        function getDefaultAnalysisData() {
            return {
                successRate: 76,
                confidenceLevel: 83,
                relationshipStage: "ì¸ ê°€ëŠ¥ì„± ë†’ìŒ",
                heroInsight: "ìƒëŒ€ë°©ì´ ë‹¹ì‹ ì—ê²Œ í˜¸ê°ì„ ê°€ì§€ê³  ìˆì„ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤",
                
                interestTrendData: getDefaultTrendData(),
                
                emotionData: {
                    positive: 64,
                    neutral: 23,
                    negative: 13
                },
                
                positiveSignals: [
                    {
                        text: "ì‘ë‹µ ì†ë„ í–¥ìƒ",
                        description: "í‰ê·  ì‘ë‹µ ì‹œê°„ì´ 3ë¶„ ì´ë‚´ë¡œ ë‹¨ì¶•ë¨",
                        confidence: 5
                    },
                    {
                        text: "ì´ëª¨í‹°ì½˜ ì‚¬ìš© ì¦ê°€",
                        description: "ëŒ€í™”ì—ì„œ ì´ëª¨í‹°ì½˜ ì‚¬ìš© ë¹ˆë„ê°€ 40% ì¦ê°€",
                        confidence: 4
                    },
                    {
                        text: "ê°œì¸ì  ì§ˆë¬¸ ì¦ê°€",
                        description: "ì¼ìƒì´ë‚˜ ê·¼í™©ì— ëŒ€í•œ ì§ˆë¬¸ì´ ëŠ˜ì–´ë‚¨",
                        confidence: 4
                    },
                    {
                        text: "ë¯¸ë˜ ê³„íš ì–¸ê¸‰",
                        description: "í•¨ê»˜í•  í™œë™ì— ëŒ€í•œ ì–¸ê¸‰ì´ ìì£¼ ë‚˜íƒ€ë‚¨",
                        confidence: 5
                    }
                ],
                
                favoriteMessage: {
                    text: "ì•„ ì˜¤ëŠ˜ ì§€ë‚˜ê°€ë‹¤ê°€ ê·¸ ì¹´í˜ ë´¤ëŠ”ë° ë„ˆ ìƒê°ë‚¬ì–´ ã…‹ã…‹ ì–¸ì œ ê°™ì´ ê°€ë³¼ê¹Œ? ğŸ˜Š",
                    confidence: 92,
                    date: "8ì›” 20ì¼ ì˜¤í›„ 3:24",
                    reason: "ìì—°ìŠ¤ëŸ¬ìš´ ë§Œë‚¨ ì œì•ˆê³¼ ê°œì¸ì  ê´€ì‹¬ í‘œí˜„"
                },
                
                conversationGuide: getDefaultConversationGuide(),
                
                customAdvice: [
                    {
                        title: "ì§€ê¸ˆ ë‹¨ê³„ì—ì„œëŠ”",
                        content: "ìƒëŒ€ë°©ì´ ë³´ë‚´ëŠ” ê¸ì •ì  ì‹ í˜¸ë¥¼ ë†“ì¹˜ì§€ ë§ê³ , ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”ë¥¼ ì´ì–´ê°€ì„¸ìš”. ë„ˆë¬´ ê¸‰í•˜ì§€ ì•Šê²Œ!"
                    },
                    {
                        title: "ë‹¤ìŒ ìŠ¤í…",
                        content: "ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°€ë²¼ìš´ ë§Œë‚¨ì„ ì œì•ˆí•´ë³´ì„¸ìš”. ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•Šì€ ì„ ì—ì„œ ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤."
                    },
                    {
                        title: "ì£¼ì˜ì‚¬í•­",
                        content: "ë°¤ëŠ¦ì€ ì‹œê°„ ì—°ë½ì€ ì¡°ê¸ˆ ì¤„ì´ê³ , ìƒëŒ€ë°©ì˜ ìƒí™œ íŒ¨í„´ì„ ì¡´ì¤‘í•˜ëŠ” ëª¨ìŠµì„ ë³´ì—¬ì£¼ì„¸ìš”."
                    }
                ]
            };
        }

        // === UI Controllers ===
        class ResultsFinalController {
            constructor(data) {
                this.data = data;
                this.init();
            }

            init() {
                this.updateHeroDashboard();
                this.renderSignals();
                this.renderFavoriteMessage();
                this.renderConversationGuide();
                this.renderCustomAdvice();
                this.startAnimations();
                this.setupInteractions();
                
                // ì°¨íŠ¸ ì´ˆê¸°í™”
                setTimeout(() => {
                    this.initCharts();
                }, 1000);
            }

            updateHeroDashboard() {
                // Update success rate
                setTimeout(() => {
                    document.getElementById('successPercentage').textContent = this.data.successRate + '%';
                    document.getElementById('successCircle').style.background = 
                        `conic-gradient(from 0deg, #ec4899 0%, #8b5cf6 ${this.data.successRate}%, #f3f4f6 ${this.data.successRate}%)`;
                }, 500);
                
                // Update other hero elements
                document.getElementById('relationshipStage').textContent = this.data.relationshipStage;
                document.getElementById('heroInsight').textContent = this.data.heroInsight;
                document.getElementById('confidenceLevel').textContent = this.data.confidenceLevel + '%';
            }

            renderSignals() {
                const container = document.getElementById('positiveSignals');
                container.innerHTML = this.data.positiveSignals.map(signal => `
                    <li class="signal-item positive-signal">
                        <div class="signal-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="signal-content">
                            <div class="signal-text">${signal.text}</div>
                            <div class="signal-description">${signal.description}</div>
                            <div class="confidence-indicator">
                                <span class="confidence-stars">
                                    ${'â˜…'.repeat(signal.confidence)}${'â˜†'.repeat(5 - signal.confidence)}
                                </span>
                                <span style="font-size: 0.8rem; margin-left: 0.5rem;">ì‹ ë¢°ë„</span>
                            </div>
                        </div>
                    </li>
                `).join('');
            }

            renderFavoriteMessage() {
                const container = document.getElementById('favoriteMessage');
                const message = this.data.favoriteMessage;
                
                container.innerHTML = `
                    <div class="message-badge">í˜¸ê°ë„ ${message.confidence}%</div>
                    <div class="message-text">${message.text}</div>
                    <div class="message-meta">
                        <i class="fas fa-clock"></i>
                        <span>${message.date}</span>
                        <span>â€¢</span>
                        <span>${message.reason}</span>
                    </div>
                `;
            }

            renderConversationGuide() {
                const container = document.getElementById('conversationGuide');
                container.innerHTML = this.data.conversationGuide.map(item => `
                    <div class="conversation-item">
                        <div class="conversation-type">${item.type}</div>
                        <div class="conversation-text">${item.text}</div>
                        <div class="conversation-timing">ğŸ’¡ ${item.timing}</div>
                    </div>
                `).join('');
            }

            renderCustomAdvice() {
                const container = document.getElementById('customAdvice');
                container.innerHTML = this.data.customAdvice.map(advice => `
                    <div class="advice-item">
                        <div class="advice-title">
                            <i class="fas fa-lightbulb"></i>
                            ${advice.title}
                        </div>
                        <div class="advice-content">${advice.content}</div>
                    </div>
                `).join('');
            }

            initCharts() {
                // ê´€ì‹¬ë„ ë³€í™” ì¶”ì´ ì°¨íŠ¸
                const interestCtx = document.getElementById('interestChart').getContext('2d');
                new Chart(interestCtx, {
                    type: 'line',
                    data: {
                        labels: this.data.interestTrendData.map(item => item.date),
                        datasets: [{
                            label: 'ê´€ì‹¬ë„ ì§€ìˆ˜',
                            data: this.data.interestTrendData.map(item => item.value),
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#8b5cf6',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                min: 0,
                                max: 100,
                                grid: { color: 'rgba(139, 92, 246, 0.1)' },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            },
                            x: {
                                grid: { color: 'rgba(139, 92, 246, 0.1)' }
                            }
                        }
                    }
                });

                // ê°ì • ë¶„ì„ ì°¨íŠ¸
                const emotionCtx = document.getElementById('emotionChart').getContext('2d');
                new Chart(emotionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ê¸ì •ì  ğŸ˜Š', 'ì¤‘ë¦½ì  ğŸ˜', 'ë¶€ì •ì  ğŸ˜”'],
                        datasets: [{
                            data: [
                                this.data.emotionData.positive,
                                this.data.emotionData.neutral,
                                this.data.emotionData.negative
                            ],
                            backgroundColor: ['#10b981', '#6b7280', '#ef4444'],
                            borderWidth: 0,
                            cutout: '60%'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    usePointStyle: true,
                                    font: { size: 12 }
                                }
                            }
                        }
                    }
                });
            }

            startAnimations() {
                // Animate cards
                const cards = document.querySelectorAll('.result-card, .column-card');
                cards.forEach((card, index) => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            }

            setupInteractions() {
                // Setup accessibility announcements
                setTimeout(() => {
                    const announcement = `ë¶„ì„ ì™„ë£Œ. ì¸ ì„±ê³µ í™•ë¥  ${this.data.successRate}í¼ì„¼íŠ¸ì…ë‹ˆë‹¤.`;
                    document.getElementById('announcements').textContent = announcement;
                }, 2000);
            }
        }

        // === Initialize App ===
        document.addEventListener('DOMContentLoaded', async () => {
            // ë¡œë”© í‘œì‹œ
            showLoadingState();
            
            try {
                // ë¶„ì„ ë°ì´í„° ì´ˆê¸°í™”
                await initializeAnalysisData();
                
                // ë°ì´í„°ê°€ ì¤€ë¹„ë˜ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ ì´ˆê¸°í™”
                new ResultsFinalController(analysisData);
                
                // ë¡œë”© ìƒíƒœ ì œê±°
                hideLoadingState();
                
            } catch (error) {
                console.error('ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                
                // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
                analysisData = getDefaultAnalysisData();
                new ResultsFinalController(analysisData);
                
                hideLoadingState();
                
                if (window.showNotification) {
                    window.showNotification('ë°ì´í„° ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë°ëª¨ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.', 'warning');
                }
            }
        });
        
        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        function showLoadingState() {
            const heroSection = document.querySelector('.hero-dashboard');
            if (heroSection) {
                heroSection.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #8b5cf6; margin-bottom: 1rem;"></i>
                        <h2>ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>
                        <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                    </div>
                `;
            }
        }
        
        // ë¡œë”© ìƒíƒœ ì œê±°
        function hideLoadingState() {
            // ë¡œë”© ë©”ì‹œì§€ëŠ” ResultsFinalControllerì—ì„œ ì‹¤ì œ ë°ì´í„°ë¡œ êµì²´ë¨
        }
    </script>
</body>
</html>